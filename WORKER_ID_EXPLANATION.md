# Worker ID 说明

## 🆔 新的 Worker ID 格式

现在 Worker ID 使用更易读的格式：

```
W{序号}-{时间戳}{随机码}
```

### 示例

- `W1-1234abcd` - 第 1 个连接的 Worker
- `W2-5678efgh` - 第 2 个连接的 Worker  
- `W3-9012ijkl` - 第 3 个连接的 Worker

### 格式说明

| 部分 | 说明 | 示例 |
|------|------|------|
| `W` | Worker 前缀 | W |
| `序号` | 连接顺序（从1开始递增） | 1, 2, 3... |
| `-` | 分隔符 | - |
| `时间戳` | 连接时间戳的后4位 | 1234 |
| `随机码` | 4位随机字符 | abcd |

## ✅ 优势

### 1. 易于区分
- 每个 Worker 都有唯一的序号
- 即使同一 IP 多个连接也能轻松区分

### 2. 易于阅读
- 短小精悍（约 10-12 个字符）
- 包含序号，一眼就能看出是第几个 Worker

### 3. 保证唯一性
- 序号 + 时间戳 + 随机码
- 几乎不可能重复

## 🧪 测试多个连接

### 测试步骤

1. **打开第一个 Worker 测试工具**
   ```
   http://localhost:3000/test-worker
   ```
   - 点击"连接"
   - 记下 Worker ID（例如：`W1-1234abcd`）

2. **打开第二个标签页**
   - 新标签页打开同样的 URL
   - 点击"连接"
   - 记下 Worker ID（例如：`W2-5678efgh`）

3. **打开第三个标签页**
   - 再次打开新标签页
   - 点击"连接"
   - 记下 Worker ID（例如：`W3-9012ijkl`）

4. **查看管理看板**
   ```
   http://localhost:3000/dashboard
   ```
   - 应该看到 3 个不同的 Worker
   - 每个都有唯一的 ID

### 预期结果

在管理看板的 Worker 状态表格中：

```
┌──────────────┬──────────┬────────┬──────────┬──────────┐
│ Worker ID    │ IP 地址  │ 状态   │ 当前任务 │ 连接时长 │
├──────────────┼──────────┼────────┼──────────┼──────────┤
│ W1-1234abcd  │ 127.0.0.1│ 空闲   │ 无任务   │ 0h 2m 5s │
│ W2-5678efgh  │ 127.0.0.1│ 空闲   │ 无任务   │ 0h 1m 30s│
│ W3-9012ijkl  │ 127.0.0.1│ 空闲   │ 无任务   │ 0h 0m 15s│
└──────────────┴──────────┴────────┴──────────┴──────────┘
```

## 🔍 如何识别 Worker

### 方法 1: 通过序号
- `W1` = 第一个连接的 Worker
- `W2` = 第二个连接的 Worker
- `W3` = 第三个连接的 Worker

### 方法 2: 通过连接时长
- 连接时间最长的是最早连接的
- 连接时间最短的是最新连接的

### 方法 3: 通过完整 ID
- 鼠标悬停在 Worker ID 上可以看到完整 ID
- 每个 Worker 的完整 ID 都是唯一的

## 📊 在 Worker 测试工具中查看

在 Worker 测试工具的日志中，连接成功后会显示：

```
✓ WebSocket 连接成功
Worker ID: W1-1234abcd
```

这个 ID 就是该 Worker 的唯一标识。

## 🔄 重启后的行为

### 服务器重启
- Worker 计数器会重置为 0
- 新连接的 Worker 会从 `W1` 开始

### Worker 重新连接
- 断开后重新连接会获得新的 ID
- 序号会继续递增（不会重用之前的序号）

## 💡 实际应用场景

### 场景 1: 多台机器的 Worker
```
W1-1234abcd  192.168.1.101  (机器 A)
W2-5678efgh  192.168.1.102  (机器 B)
W3-9012ijkl  192.168.1.103  (机器 C)
```

### 场景 2: 同一台机器的多个 Worker
```
W1-1234abcd  127.0.0.1  (浏览器标签 1)
W2-5678efgh  127.0.0.1  (浏览器标签 2)
W3-9012ijkl  127.0.0.1  (浏览器标签 3)
```

### 场景 3: 混合场景
```
W1-1234abcd  192.168.1.101  (远程机器)
W2-5678efgh  127.0.0.1      (本地测试 1)
W3-9012ijkl  127.0.0.1      (本地测试 2)
W4-3456mnop  192.168.1.102  (另一台远程机器)
```

## 🐛 故障排查

### 问题: 看到的 Worker ID 都一样

**可能原因**:
1. 浏览器缓存问题
2. 页面没有刷新

**解决方法**:
1. 按 `Ctrl + F5` 强制刷新管理看板
2. 清除浏览器缓存
3. 重启服务器

### 问题: Worker ID 显示不完整

**可能原因**:
- 表格列宽度不够

**解决方法**:
- 横向滚动表格
- 鼠标悬停在 ID 上查看完整 ID
- 放大浏览器窗口

## ✅ 验证 Worker ID 唯一性

在浏览器控制台运行：

```javascript
fetch('/api/dashboard/workers')
  .then(r => r.json())
  .then(data => {
    const ids = data.workers.map(w => w.id);
    const uniqueIds = new Set(ids);
    console.log('Worker 总数:', ids.length);
    console.log('唯一 ID 数量:', uniqueIds.size);
    console.log('所有 ID:', ids);
    
    if (ids.length === uniqueIds.size) {
      console.log('✅ 所有 Worker ID 都是唯一的！');
    } else {
      console.log('❌ 发现重复的 Worker ID！');
    }
  });
```

## 🎉 总结

现在每个 Worker 都有：
- ✅ 唯一的 ID
- ✅ 易读的格式
- ✅ 清晰的序号
- ✅ 完整的显示

即使同一 IP 多个浏览器连接，也能轻松区分！
